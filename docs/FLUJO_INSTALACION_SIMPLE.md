# ðŸŽ¯ FLUJO SIMPLE - InstalaciÃ³n GitHub App

## ðŸ“± Lo que ve el Usuario (Paso a Paso)

### **PASO 1: En tu aplicaciÃ³n web**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ParadoxBoard - Tu AplicaciÃ³n      â”‚
â”‚                                     â”‚
â”‚   ðŸš€ Gestiona tus proyectos         â”‚
â”‚       con GitHub                    â”‚
â”‚                                     â”‚
â”‚   [ Conectar con GitHub ]  â†â”€ Clickâ”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### **PASO 2: GitHub le pide autorizaciÃ³n**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ðŸ” ParadoxBoard quiere acceder a tus repos    â”‚
â”‚                                                 â”‚
â”‚  Esta app podrÃ¡:                                â”‚
â”‚  âœ“ Ver tus repositorios                         â”‚
â”‚  âœ“ Leer y escribir cÃ³digo                       â”‚
â”‚  âœ“ Crear y modificar issues                     â”‚
â”‚  âœ“ Gestionar pull requests                      â”‚
â”‚                                                 â”‚
â”‚  ðŸ“‚ Â¿DÃ³nde instalar?                            â”‚
â”‚                                                 â”‚
â”‚  â—‹ Todos los repositorios                       â”‚
â”‚  â— Solo repositorios seleccionados              â”‚
â”‚     â˜‘ ParadoxBoard/service-java                 â”‚
â”‚     â˜‘ ParadoxBoard/frontend-app                 â”‚
â”‚     â˜ ParadoxBoard/otro-repo                    â”‚
â”‚                                                 â”‚
â”‚  [Cancelar]  [Instalar]  â†â”€â”€â”€â”€â”€ Click aquÃ­     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### **PASO 3: GitHub procesa la instalaciÃ³n**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â³ Instalando ParadoxBoard...      â”‚
â”‚                                     â”‚
â”‚  âœ“ Configurando permisos            â”‚
â”‚  âœ“ Conectando repositorios          â”‚
â”‚  âœ“ Activando webhooks               â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**GitHub hace internamente:**
1. Crea `installation_id = 97878002`
2. Asocia con la organizaciÃ³n "ParadoxBoard"
3. Guarda repos seleccionados
4. EnvÃ­a webhook a tu servidor âš¡

---

### **PASO 4: Usuario regresa a tu app**

```
URL: https://tu-app.com/callback?installation_id=97878002
                                 â†‘
                          GitHub lo agrega automÃ¡ticamente

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   âœ… InstalaciÃ³n Exitosa            â”‚
â”‚                                     â”‚
â”‚   Configurando tu cuenta...         â”‚
â”‚   â³ Sincronizando repositorios     â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### **PASO 5: Usuario ve su dashboard**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ParadoxBoard Dashboard                        â”‚
â”‚   ðŸ‘¤ ParadoxBoard                               â”‚
â”‚                                                 â”‚
â”‚   ðŸ“‚ Tus Repositorios Conectados (2)           â”‚
â”‚                                                 â”‚
â”‚   ðŸŸ¢ service-java                   [Privado]  â”‚
â”‚      â”œâ”€ 3 branches                              â”‚
â”‚      â”œâ”€ 45 commits                              â”‚
â”‚      â””â”€ 2 PRs abiertos                          â”‚
â”‚                                                 â”‚
â”‚   ðŸŸ¢ frontend-app                   [PÃºblico]  â”‚
â”‚      â”œâ”€ 2 branches                              â”‚
â”‚      â”œâ”€ 23 commits                              â”‚
â”‚      â””â”€ 1 issue abierto                         â”‚
â”‚                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸ”§ Lo que sucede en el Backend

### **Momento 1: Usuario hace click en "Instalar"**

```
GitHub
  â”‚
  â”‚ EnvÃ­a Webhook âš¡
  â†“
POST /webhooks/github
Event: installation (created)
  â”‚
  â†“
WebhookService
  â”œâ”€ âœ… Valida firma HMAC
  â”œâ”€ ðŸ’¾ Guarda log en BD
  â”œâ”€ ðŸ—ï¸ Crea Installation en BD
  â””â”€ ðŸ“ Log: "Installation 97878002 created"
```

### **Momento 2: Usuario llega a tu app con installation_id**

```
Frontend captura: installation_id=97878002
  â”‚
  â†“
POST /auth/github/register
Body: {"installationId": 97878002}
  â”‚
  â†“
AuthController.registerWithInstallation()
  â”‚
  â”œâ”€ 1ï¸âƒ£ GET GitHub API: /app/installations/97878002
  â”‚     â†“
  â”‚     Info de la instalaciÃ³n (owner, permisos, etc.)
  â”‚
  â”œâ”€ 2ï¸âƒ£ InstallationService.createOrUpdateFromGitHub()
  â”‚     â†“
  â”‚     ðŸ’¾ Guarda/actualiza Installation en BD
  â”‚
  â”œâ”€ 3ï¸âƒ£ SyncService.syncInitial()
  â”‚     â”œâ”€ Obtiene installation token
  â”‚     â”œâ”€ GET GitHub API: /installation/repositories
  â”‚     â””â”€ ðŸ’¾ Guarda cada repo en BD
  â”‚
  â”œâ”€ 4ï¸âƒ£ UserService.createOrUpdateFromGithub()
  â”‚     â†“
  â”‚     ðŸ’¾ Crea/actualiza user en BD
  â”‚     ðŸ’¾ Vincula user â†” installation
  â”‚
  â””â”€ 5ï¸âƒ£ Retorna JSON:
        {
          "user": {...},
          "installation": {...},
          "syncedRepositories": [...]
        }
```

---

## ðŸŽ¨ Diagrama Visual Completo

```
    USUARIO                  GITHUB              TU BACKEND           TU FRONTEND
       â”‚                        â”‚                    â”‚                    â”‚
       â”‚  1. "Conectar GitHub"  â”‚                    â”‚                    â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                    â”‚                    â”‚
       â”‚                        â”‚                    â”‚                    â”‚
       â”‚  2. Pantalla permisos  â”‚                    â”‚                    â”‚
       â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚                    â”‚
       â”‚                        â”‚                    â”‚                    â”‚
       â”‚  3. "Instalar"         â”‚                    â”‚                    â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                    â”‚                    â”‚
       â”‚                        â”‚                    â”‚                    â”‚
       â”‚                        â”‚  4. Webhook        â”‚                    â”‚
       â”‚                        â”‚  (installation)    â”‚                    â”‚
       â”‚                        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                    â”‚
       â”‚                        â”‚                    â”‚                    â”‚
       â”‚                        â”‚               [Guarda Installation]     â”‚
       â”‚                        â”‚               [Guarda repos]            â”‚
       â”‚                        â”‚                    â”‚                    â”‚
       â”‚  5. Redirect con ID    â”‚                    â”‚                    â”‚
       â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚                    â”‚
       â”‚  (installation_id)     â”‚                    â”‚                    â”‚
       â”‚                        â”‚                    â”‚                    â”‚
       â”‚  6. Abre app                                â”‚                    â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
       â”‚                        â”‚                    â”‚                    â”‚
       â”‚                        â”‚                    â”‚  7. POST /register â”‚
       â”‚                        â”‚                    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
       â”‚                        â”‚                    â”‚  {installationId}  â”‚
       â”‚                        â”‚                    â”‚                    â”‚
       â”‚                        â”‚  8. GET /app/...   â”‚                    â”‚
       â”‚                        â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚
       â”‚                        â”‚  (con JWT)         â”‚                    â”‚
       â”‚                        â”‚                    â”‚                    â”‚
       â”‚                        â”‚  9. Installation   â”‚                    â”‚
       â”‚                        â”‚     data           â”‚                    â”‚
       â”‚                        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                    â”‚
       â”‚                        â”‚                    â”‚                    â”‚
       â”‚                        â”‚ 10. GET /install/  â”‚                    â”‚
       â”‚                        â”‚     repositories   â”‚                    â”‚
       â”‚                        â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚
       â”‚                        â”‚                    â”‚                    â”‚
       â”‚                        â”‚ 11. Repos data     â”‚                    â”‚
       â”‚                        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                    â”‚
       â”‚                        â”‚                    â”‚                    â”‚
       â”‚                        â”‚              [Sincroniza todo]          â”‚
       â”‚                        â”‚              [Crea user]                â”‚
       â”‚                        â”‚                    â”‚                    â”‚
       â”‚                        â”‚                    â”‚ 12. Response       â”‚
       â”‚                        â”‚                    â”‚    + JWT           â”‚
       â”‚                        â”‚                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
       â”‚                        â”‚                    â”‚                    â”‚
       â”‚ 13. Dashboard con repos                     â”‚                    â”‚
       â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
       â”‚                        â”‚                    â”‚                    â”‚
```

---

## ðŸ“Š Datos que Fluyen

### **Del Usuario â†’ GitHub:**
```json
{
  "action": "install",
  "repositories": ["service-java", "frontend-app"],
  "permissions": "accepted"
}
```

### **De GitHub â†’ Tu Backend (Webhook):**
```json
{
  "action": "created",
  "installation": {
    "id": 97878002,
    "account": {
      "login": "ParadoxBoard",
      "type": "Organization"
    }
  },
  "repositories": [...]
}
```

### **De GitHub â†’ Tu Backend (API):**
```json
GET /app/installations/97878002
Response:
{
  "id": 97878002,
  "account": {...},
  "permissions": {...},
  "repository_selection": "selected"
}

GET /installation/repositories
Response:
{
  "total_count": 2,
  "repositories": [
    {"id": 123, "name": "service-java", ...},
    {"id": 456, "name": "frontend-app", ...}
  ]
}
```

### **De Tu Backend â†’ Frontend:**
```json
{
  "user": {
    "id": "uuid",
    "username": "ParadoxBoard",
    "githubInstallationId": "97878002"
  },
  "installation": {
    "installationId": 97878002,
    "accountLogin": "ParadoxBoard"
  },
  "syncedRepositories": [
    {
      "id": "uuid",
      "name": "service-java",
      "fullName": "ParadoxBoard/service-java",
      "private": false
    }
  ]
}
```

---

## ðŸ”‘ Conceptos Clave

### **Installation ID**
- **QuÃ© es:** ID Ãºnico de la instalaciÃ³n (ej: 97878002)
- **QuiÃ©n lo crea:** GitHub
- **CuÃ¡ndo:** Al instalar la app
- **Para quÃ©:** Identificar esa instalaciÃ³n especÃ­fica

### **Installation Token**
- **QuÃ© es:** Token temporal de acceso
- **DuraciÃ³n:** 1 hora
- **Para quÃ©:** Acceder a repos de esa instalaciÃ³n
- **CÃ³mo obtenerlo:** Con JWT de tu app

### **Repository Selection**
- **All:** Acceso a todos los repos (presentes y futuros)
- **Selected:** Solo repos especÃ­ficos que el usuario eligiÃ³

---

## âœ… Checklist de VerificaciÃ³n

Para confirmar que la instalaciÃ³n funcionÃ³:

```sql
-- 1. Verificar instalaciÃ³n en BD
SELECT * FROM installations WHERE installation_id = 97878002;

-- 2. Verificar repos sincronizados
SELECT name, full_name FROM repositories 
WHERE installation_id = (
  SELECT id FROM installations WHERE installation_id = 97878002
);

-- 3. Verificar usuario vinculado
SELECT username, github_installation_id FROM users
WHERE github_installation_id = '97878002';
```

**DeberÃ­as ver:**
âœ… 1 instalaciÃ³n  
âœ… N repositorios  
âœ… 1 usuario vinculado  

---

## ðŸŽ¯ Resumen Ultra-RÃ¡pido

```
Usuario â†’ "Instalar app" â†’ GitHub
                            â†“
                    Webhook a tu servidor
                            â†“
                    Guarda Installation
                            â†“
Usuario â†’ Regresa a tu app con installation_id
                            â†“
Frontend â†’ POST /auth/github/register
                            â†“
Backend â†’ Sincroniza repos â†’ Crea user
                            â†“
Usuario â†’ Ve dashboard con repos âœ…
```

---

Â¿Necesitas ayuda para implementar el frontend que capture automÃ¡ticamente el `installation_id`? ðŸš€

